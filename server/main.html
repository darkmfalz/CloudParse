<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="author" content="Adeeb Sheikh">

	<title>
		Main Page | iGG
	</title>

	<link rel="stylesheet" type="text/css" href="./main.css">

	<link rel="shortcut icon" href="./img/icons/favicon.ico" type="image/x-icon">
	<link rel="icon" href="./img/icons/favicon.ico" type="image/x-icon">

	<script src="http://code.jquery.com/jquery-1.11.3.min.js">
	</script>

	<script type="text/javascript">
		$.ajax({

			url: "/cgi-bin/server-authenticate.py",

			data: {
			},

			type: "GET",

			dataType: "json",

			success: function(data){

				console.log("Currently logged in as:");
				console.log(data.username);
				window.location.assign("./users/".concat(data.username));

			},

			error: function(){

				console.log("Not logged in.");
				window.location.assign("./login");

			}

		});

		$(document).ready(function(){

			$.ajax({

				url: "/cgi-bin/banner.py",

				data: {
				},

				type: "GET",

				dataType: "html",

				success: function(data){

					$("div.banner").html(data);

				}

			});

			$(document).on('submit', '#login', function(e){

				//get the username and password from the textbox
				var username = $("#username").val();
				var password = $("#password").val();

				if (document.getElementById('persist_box').checked) {
					var checked = "TRUE";
				} 
				else {
					var checked = "FALSE";
				}
				console.log(username);
				console.log(checked);

				$.ajax({

					url: "/cgi-bin/server-login.py",

					data: {
						requested_username: username,
						requested_password: password,
						keep_loggedin: checked
					},

					type: "POST",

					dataType: "json",

					success: function(data){

						console.log("Successfully logged in as:");
						console.log(data.username);
						$("#username").val("");
						$("#password").val("");
						window.location.assign("./users/".concat(data.username));

					},

					error: function(){

						alert("There was a problem: invalid username/password combination.");
						$("#username").val("");
						$("#password").val("");

					}


				});

				e.preventDefault();

				return false;

			});

			$(document).on('submit', '#logout', function(e){
						
				$.ajax({

					url: "/cgi-bin/server-logout.py",

					data: {
					},

					type: "POST",

					datatype: "json",

					success: function(data){

						window.location.assign("../login");

					},

					error: function(){

						console.log("Error logging out.");

					}

				});

				e.preventDefault();
				return false;
			});

		});
	</script>
</head>

<body>
	<div class="wrapper">
		<div class="banner">
		</div>

		<div class="mainpage">
		</div>
	</div>
	
	<div class="footer" xmlns:dc="http://purl.org/dc/elements/1.1/">
		<img src="img/icons/hr.png" style="vertical-align:middle">
		<p id="copyright" property="dc:rights">&copy;
			<span property="dc:dateCopyrighted">2015</span>
			<span property="dc:publisher">Adeeb Sheikh</span>
		</p>
	</div>

</body>

</html>